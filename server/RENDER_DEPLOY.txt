Deploy no Render.com - Guia Completo
====================================

Render.com e uma excelente alternativa ao Railway, com plano gratuito generoso.

PASSO 1: Criar Conta
--------------------

1. Vai a https://render.com
2. Clica em "Get Started for Free"
3. Regista-te com GitHub (recomendado) ou email

PASSO 2: Criar Novo Web Service
--------------------------------

1. No dashboard, clica em "New +"
2. Escolhe "Web Service"
3. Conecta o teu repositorio GitHub:
   - Se ainda nao conectaste, autoriza o Render a aceder ao teu GitHub
   - Seleciona o repositorio: jpxdpt/SGI
   - Seleciona a branch: master

PASSO 3: Configurar Build
-------------------------

Nome do Servico:
   sgi-backend (ou o nome que preferires)

Regiao:
   Europe (Frankfurt) ou a mais proxima de ti

Branch:
   master

Root Directory:
   server

   IMPORTANTE: Define o Root Directory como "server" para o Render saber onde esta o backend

Runtime:
   Node

Build Command:
   npm install && npx prisma generate

Start Command:
   npm run dev

   OU para producao:
   npm run start:prod

PASSO 4: Configurar Variaveis de Ambiente
------------------------------------------

Clica em "Advanced" e depois em "Add Environment Variable"

Adiciona todas estas variaveis:

   DATABASE_URL=postgresql://... (a tua connection string do Neon)
   JWT_SECRET=um-secret-aleatorio-muito-seguro-aqui
   JWT_REFRESH_SECRET=outro-secret-aleatorio-muito-seguro-aqui
   DEFAULT_TENANT_ID=tenant-default
   PORT=10000
   NODE_ENV=production
   FRONTEND_URL=https://dashboard-xxx.vercel.app (URL do teu frontend no Vercel)
   ALLOW_ALL_ORIGINS=true
   BASE_PATH=/api

NOTA: O Render define automaticamente a variavel PORT, mas podes definir como 10000.
      O Render expoe a aplicacao na porta que definires.

PASSO 5: Configurar Plano
--------------------------

Plano:
   Free (para comecar)

   O plano gratuito tem:
   - 750 horas por mes (suficiente para 24/7)
   - Sleep apos 15 minutos de inatividade (acorda quando recebe request)
   - 512MB RAM
   - 0.5 CPU

PASSO 6: Deploy
---------------

1. Clica em "Create Web Service"
2. O Render vai comecar a fazer build automaticamente
3. Podes ver os logs em tempo real
4. Quando terminar, teras uma URL tipo: https://sgi-backend.onrender.com

PASSO 7: Configurar Base de Dados (Opcional)
---------------------------------------------

Se quiseres uma base de dados gerida pelo Render:

1. Clica em "New +" -> "PostgreSQL"
2. Escolhe plano Free
3. Cria a base de dados
4. Copia a "Internal Database URL" ou "External Database URL"
5. Usa essa URL na variavel DATABASE_URL do teu Web Service

PASSO 8: Atualizar Frontend
---------------------------

No Vercel, atualiza a variavel de ambiente:

   VITE_API_BASE_URL=https://sgi-backend.onrender.com/api

   (Substitui "sgi-backend" pelo nome do teu servico)

TROUBLESHOOTING
---------------

Problema: Build falha com erro de canvas
Solucao: O Render pode ter problemas com canvas. Podes:
   - Remover chartjs-node-canvas das dependencias se nao for essencial
   - Ou usar uma imagem Docker customizada

Problema: Servico "sleeps" apos 15 minutos
Solucao: No plano gratuito, o servico "dorme" apos inatividade.
         A primeira request apos dormir pode demorar ~30 segundos.
         Para evitar isto, podes:
         - Usar um servico de "ping" gratuito (ex: UptimeRobot)
         - Fazer upgrade para plano pago

Problema: Erro de CORS
Solucao: Verifica que ALLOW_ALL_ORIGINS=true esta definido
         E que FRONTEND_URL tem o URL correto do Vercel

Problema: Erro de PORT
Solucao: O Render define PORT automaticamente. Nao precisas definir manualmente,
         mas se definires, usa 10000.

VANTAGENS DO RENDER
-------------------

- Plano gratuito generoso (750h/mes)
- Deploy automatico do GitHub
- Suporte para Docker (opcional)
- Base de dados PostgreSQL gerida (opcional)
- SSL automatico
- Logs em tempo real
- Muito similar ao Railway

DESVANTAGENS
------------

- Sleep apos 15min de inatividade (plano gratuito)
- Primeira request apos sleep pode demorar ~30s
- Limite de 512MB RAM no plano gratuito

ALTERNATIVAS SE RENDER NAO FUNCIONAR
-------------------------------------

1. Fly.io - Plano gratuito, sem sleep
2. Render.com com Docker - Mais controlo sobre o ambiente
3. Vercel (serverless) - Ja tentamos, mas tinha problemas CORS
4. Heroku - Tem plano gratuito limitado

DICAS FINAIS
------------

1. Usa o Root Directory "server" para o Render saber onde esta o codigo
2. O Build Command deve instalar dependencias e gerar Prisma Client
3. O Start Command deve iniciar o servidor Node
4. Configura todas as variaveis de ambiente antes do primeiro deploy
5. O Render faz deploy automatico sempre que fazes push para GitHub

Se precisares de ajuda, avisa!

